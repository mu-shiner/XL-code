{extend name='public:parent'}

{block name="right"}
<link href="{$Think.config.web_root}/plugins/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet">
<style>
.maskLayer {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.3);
    z-index: 1000;
    display: none;
    /*opacity: 0.3;*/
}
    .send {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 30%;
        height: 300px;
        background: #fff;
        border-radius: 20px;
    }
    .sendMessage {
        width: 100%;
        height: 50px;
        margin-bottom: 30px;
        border-bottom: 1px solid  #909399;
        font-size: 22px;
        line-height: 50px;
        text-align: center;
    }
    .sendLogistics {
        width: 100%;
        height: 50px;
        padding-left: 20px;
        margin-bottom: 20px;
    }
    .sendLogistics span {
        margin-right: 10px;
    }
    .sendLogistics input {
        height: 30px;
        border: 1px solid #909399;
        /*outline: #909399 solid 1px ;*/
        outline: none;
    }
    .sendLogistics input:focus {
        border: 1px solid #909399;
    }
    .sendLogistics select {
        width: 170px;
        height: 30px;
        text-align: center;
        outline: none;
    }
    .sendLogistics select:focus {
        border: 1px solid #909399;
    }
    .button {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
    }
    
    .confirm {
        width: 70px;
        height: 40px;
        line-height: 40px;
        text-align: center;
        border-radius: 10px;
        font-size: 18px;
        color: #fff;
        background-color: #409EFF;
        margin-right: 50px;
    }
    .cancel {
        width: 70px;
        height: 40px;
        line-height: 40px;
        text-align: center;
        border-radius: 10px;
        font-size: 18px;
        color: #fff;
        background-color: #606266;
    }
</style>
    <div id="content-container" class="goods_container">
        <div class="div_local">
            <ol class="breadcrumb">
                <li><a href="/admin/Index/index">首页</a></li>
                <li><a href="#">团购管理</a></li>
                <li class="active">货币兑换列表</li>
            </ol>
        </div>
        <div style="display:flex;justify-content: space-between;">  
        <div class="cf">
            <form class="form-inline" action="" method="get">
               
                <label class="inline">货币名称</label>
                    <select name="money_id" class="form-control">
                            <option value="">--全部--</option>
                            {foreach name="$moneylist" item="vo"}
                            <option value="{$vo['money_id']}"}>{$vo['money_name']}</option>
                            {/foreach}
                        </select>
                <label class="inline">用户</label>
                <input type="text" name="username" value="" class="form-control">
                <label class="inline">钱包地址</label>
                <input type="text" name="money_address" value="" class="form-control">
                
                <label class="inline">审核状态</label>
                        <select name="status" class="form-control">
                            <option value="">--全部--</option>
                            <option value="1">--待审核--</option>
                            <option value="2">--已成功--</option>
                            <option value="3">--已失败--</option>
                        </select>
                <label class="inline">兑换时间</label>
                    <div class="form-control">
                        <input type="text" name="begin_time" value="" id="datetimepicker1">
                        <span> - </span>
                        <input type="text" name="end_time" value="" id="datetimepicker2">
                    </div>
                <button type="submit" class="btn btn-purple btn-sm">
                    <span class="ace-icon fa fa-search icon-on-right bigger-110"></span>
                    搜索
                </button>
            </form>
        </div>
        
            <div class="text-xs-center">
                <div class="form-group">
                
                {if isset($_GET)}
                        <a href="{:url('Admin/group/daochu',$_GET)}"><button id="demo-btn-addrow" class="btn btn-purple"><i class="demo-pli-plus"></i> 导出Excel</button></a>
                {else}
                        <a href="{:url('Admin/group/daochu')}"><button id="demo-btn-addrow" class="btn btn-purple"><i class="demo-pli-plus"></i> 导出Excel</button></a>
                {/if}
                </div>
            </div>
        </div>
        <input type="button" value="全选" class="btn btn-primary btn-sm" id="checkall">
	    <input type="button" value="全不选" class="btn btn-info btn-sm" id="checkalls">
	    <input type="button" value="通过" class="btn btn-success btn-sm" id="success">
	    <input type="button" value="不通过" class="btn btn-danger btn-sm" id="fail">
        <div class="goods_content" style="margin-top:20px">
            <table class="table table-bordered ">
                <thead>
                    <tr>
                        <th>选择</th>
                        <th>ID</th>
                        <th>用户</th>
                        <th>用户电话</th>
                        <th>兑换通用券数</th>
                        <th>货币名称</th>
                        <th>钱包地址</th>
                        <th>兑换时间</th>
                        <th>审核时间</th>
                        <th>状态</th>
                        <!--<th>操作</th>-->
                    </tr>
                </thead>
                <tbody>
                {foreach name="$list" item="vo"}
                <tr>
                    <td>{if $vo['status']=='1'}<input type="checkbox" name="idlist" value="{$vo.id}">{/if}</td>
                    <td>{$vo['id']}</td>
                    <td>{$vo['username']}</td>
                    <td>{$vo['phone']}</td>
                    <td>{$vo['num']}</td>
                    <td>{$vo['money_name']}</td>
                    <td>{$vo['money_address']}</td>
                    <td>{$vo['create_time']}</td>
                    <td>{$vo['finish_time']}</td>
                    <td>{$vo['state_name']}</td>
                    <!--<td>-->
                     
                    <!--</td>-->
                </tr>
                {/foreach}
                </tbody>
                
            </table>
            {$list->render()}
        </div>
     
     <!--<div class="maskLayer" id="modal">-->
     <!--    <div class="send">-->
     <!--     <div class="sendMessage">发货信息</div>-->
     <!--     <div>-->
     <!--         <div class="sendLogistics">-->
     <!--             <span>发货物流</span>-->
                  <!--<input type="select" name="" id="" value="" />-->
     <!--             <select id="sendSelect">-->
     <!--                 <option>--请选择发货物流--</option>-->
     <!--                 <option>顺丰</option>-->
     <!--                 <option>极兔</option>-->
     <!--                 <option>中通</option>-->
     <!--                 <option>圆通</option>-->
     <!--                 <option>韵达</option>-->
     <!--                 <option>邮政</option>-->
     <!--                 <option>京东</option>-->
     <!--             </select>-->
     <!--         </div>-->
     <!--         <div class="sendLogistics">-->
     <!--             <span>发货单号</span>-->
     <!--             <input type="tetx" name="" id="sendLogistics" value="" />-->
     <!--         </div>-->
     <!--         <div class="button">-->
     <!--             <div class="confirm" onclick="confirm()">确认</div>-->
     <!--             <div class="cancel" onclick="cancel()">取消</div>-->
     <!--         </div>-->
     <!--         <input type="hidden" name=""  id="hiddenId" value="" />-->
     <!--     </div>-->
     <!-- </div>-->
     <!--</div>   -->
      
    </div>
    
    

    <script type="text/javascript" src="{$Think.config.web_root}/plugins/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript" src="{$Think.config.web_root}/plugins/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js"></script>
    <script>
    $('#datetimepicker1').datepicker({
        format: 'yyyy-mm-dd',
        language: 'zh-CN',
    });
    $('#datetimepicker2').datepicker({
        format: 'yyyy-mm-dd',
        language: 'zh-CN',
    });
    //全选
    $('#checkall').click(function(){
        $("input[type='checkbox']").prop("checked",true);
    })
    	//反选
    $('#checkalls').click(function(){
    	$("input[type='checkbox']").prop("checked",false);
    })
    
    //通过
    $('#success').click(function(){
    	var chk_value =[];//定义一个数组    
            $('input[name="idlist"]:checked').each(function(){
            chk_value.push($(this).val());
            });
    	// alert(chk_value);
        $.ajax({
        	type:"POST",
        	url:"editExchange",
        	data:{
        		idlist:chk_value,
        		status:2
        	},
        	success: function (res) {
        	    alert(res);
            },
            error: function (error) {
                alert('失败');
            }
        })
    })
    
    //不通过
    $('#fail').click(function(){
    	var chk_value =[];//定义一个数组    
            $('input[name="idlist"]:checked').each(function(){
            chk_value.push($(this).val());
            });
    	// alert(chk_value);
        $.ajax({
        	type:"POST",
        	url:"editExchange",
        	data:{
        		idlist:chk_value,
        		status:3
        	},
        	success: function (res) {
        	    alert(res);
        	    window.location.reload();
            },
            error: function (error) {
                alert('失败');
            }
            
        })
    })

    
        function send (id) {
            $('#hiddenId').val(id);
            $('#modal').css('display','block');
        }
        function cancel () {
            $('#modal').css('display','none');
        }
        
        function confirm () {
            
        $.ajax('delivery', {
            method: 'POST',
            data: {logisticsCompany: $('#sendSelect').val(), logisticsNo: $('#sendLogistics').val(), id:$('#hiddenId').val()},
            success:function (result) {
                alert(result.msg)
                if(result.code == 0)
                {
                    location.href= 'lotteryShip';
                }
               
            },
            error:function (err) {
                console.log(err);
            }
        })
        }
    </script>
{/block}